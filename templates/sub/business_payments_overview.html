{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141253078-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141253078-2');
</script>
  <title>Billntrade</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  {% block title %}

  {% endblock %}
  </title>
  <!-- Bootstrap core CSS -->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'css/main.css' %}" rel="stylesheet">
  <link rel="icon" type="image/png" href='/static/img/favicon-32x32.png'>

  <!-- Custom styles for this template -->
  <link href="{% static 'css/dashboard.css' %}" rel="stylesheet">
</head>

<body>
    <!-- ======= Header ======= -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top bg-light py-0 class">
    <a href=""><img src="{% static 'img/Logo.png' %}" alt="" class="img-fluid brand"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="d-flex ml-auto">
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
        </ul>
        <ul class="navbar-nav ml-auto mr-5">
          <li class="nav-item dropdown ml-auto">
            <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">{{request.user}}</a>

            <div class="dropdown-menu dropdown-menu-right">
              <a class="dropdown-item" href="{% url 'logout-view' %}">Logout</a>
            </div>
          </li>
        </ul>
      </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      {% include 'partials/_bus_payments.html' %}
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
        <div class="col-auto mt-3">
        </div>
        {% block content %}
        {% include 'partials/_messages.html' %}

        <div class="col-md-8"></div>
        <div class="col-auto md-2 my-2">
          <form class="form-inline" action="{% url 'business-payments' %}">
            <div class="card mt-3 style=width: 18rem;"></div>
            {% csrf_token %}
            <div class="col-md-8"></div>
            <!-- <input name="q" value="{{query}}" class="form-control mr-sm-2" id="searchField" type="search"
              placeholder="Search" aria-label="Search"> -->
            <!-- <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button> -->
          </form>
        </div>
        <ul class="nav nav-tabs">
        
          <li class="nav-item">
            <a href="#Invoices" class="nav-link active" data-toggle="tab">Invoices</a>
          </li>   
        </ul>
        <div class="tab-content">
          <br>
       
          <div class="tab-pane fade show active" id="Invoices">
                  <table class="table table-striped">
                      <thead>
                        <tr>
                          <th scope="col">#</th>
                          <th scope="col">Username</th>
                          <th scope="col">Invoice no.</th>
                          <th scope="col">Amount paid (Â£)</th>
                          <th scope="col">No of users</th>
                          <th scope="col">Status</th>
                          <th scope="col">Date created</th>
                          <th style="text-align:center" scope="col">Invoices</th>
                          <th style="text-align:center" scope="col">Receipts</th>
                        </tr>
                      </thead>
                      <tbody id='invoices-list'>
                       
                        
                      </tbody>
                    </table>
          </div>
          <div class="tab-pane fade" id="messages">
            <p>pending ...</p>
          </div>
        </div>
    </div>
    </main>
  </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script src="{% static 'js/bootstrap.feather.js' %}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
  <script src="{% static 'js/min.js' %}"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="{% static 'js/main.js' %}"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="{% static 'js/function.js' %}"></script>
  <script src="https://unpkg.com/feather-icons@4.10.0/dist/feather.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>
      $(document).ready(function () {
        feather.replace();
  
        $('button').click(function () {
          $('.alert').html('<i data-feather="activity"></i>');
          feather.replace();
        });
        var searchField = $("#searchField").val()
        if (searchField === "None") {
          $("#searchField").val("");
        }
  
      });
  
        $(document).ready(function () {
          $('#dtHorizontalExample').DataTable({
            "scrollX": true
          });
          $('.dataTables_length').addClass('bs-select');
        });
        $(document).ready(function () {
  
          var htmllData = ''
  
          function getData(date)
          {
            const months = {
              0: 'January',
              1: 'February',
              2: 'March',
              3: 'April',
              4: 'May',
              5: 'June',
              6: 'July',
              7: 'August',
              8: 'September',
              9: 'October',
              10: 'November',
              11: 'December'
            }
            
            var monthIndex = date.getMonth()
            var monthName = months[monthIndex]
            var year = date.getFullYear()
            var date = date.getDate() 
            return monthName + ' ' + date  + ', ' + year
        
          }
  
          $.ajax({
          url: '{% url "invoicesListJSON" %}',
        
          dataType: 'json',
  
          success: function (datas) {
  
           var htmlData = ''
           datas['data'].forEach(function (data,i) {
             
              var status = ''
              var milliseconds = data['created'] * 1000 
              var dateObject = new Date(milliseconds)
              getData(dateObject)
              var noOfUsers = parseInt(data['amount_paid']) / 20
              var amount = parseInt(data['amount_paid']) / 100
              console.log(data)
              noOfUsers = noOfUsers/ 100
              htmlData += `<tr>
                            <th class="align-middle" scope="row">${i+1}</th>
                            <td class="align-middle">{{user.username}}</td>
                            <td class="align-middle">${data['number']}</td>
                            <td class="align-middle">${amount}</td>
                            <td class="align-middle">${data['lines']['data'][0]['quantity']}</td>
                            <td class="align-middle">${data['status']}</td>
                            <td class="align-middle">${getData(dateObject)}</td>
                            <td style="text-align:center"> <a target="_blank" href ="${data['invoice_pdf']}" class='btn btn-outline-primary' style="color: black" > View </a> </td>
                            <td style="text-align:center"> <a target="_blank" href ="${data['hosted_invoice_url']}" class='btn btn-outline-primary' style="color: black" > View </a> </td>
                          </tr>`
                          
                          });
               
            $('#invoices-list').append(htmlData)           
           }
        });
        });
  </script>

<style>
    .brand {
        height: auto;
        width: auto;
        max-height: 72px;
        max-width: 250px;
    }
  </style>

      </body>
{% endblock %}
</html>